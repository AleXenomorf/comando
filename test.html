<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ê–Ω–∫–µ—Ç–∞ ‚Äî –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
    
    :root {
      --primary: #00ff88;
      --primary-dark: #00cc6a;
      --secondary: #0a84ff;
      --bg-main: #0a0a0a;
      --bg-card: #111111;
      --bg-input: #1a1a1a;
      --text-primary: #ffffff;
      --text-secondary: #a0a0a0;
      --border: #333333;
      --shadow: 0 8px 32px rgba(0, 255, 136, 0.15);
      --gradient: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Inter', system-ui, sans-serif;
      background: var(--bg-main);
      color: var(--text-primary);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      background-image: 
        radial-gradient(circle at 20% 50%, rgba(0, 255, 136, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(10, 132, 255, 0.1) 0%, transparent 50%);
    }

    .container {
      max-width: 500px;
      width: 100%;
      background: var(--bg-card);
      border-radius: 24px;
      padding: 40px;
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
      backdrop-filter: blur(20px);
      position: relative;
      overflow: hidden;
      animation: slideUp 0.6s ease-out;
    }

    .container::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0;
      height: 2px;
      background: var(--gradient);
    }

    @keyframes slideUp {
      from { opacity: 0; transform: translateY(30px); }
      to   { opacity: 1; transform: translateY(0);    }
    }

    .header { text-align: center; margin-bottom: 32px; }
    .title {
      font-size: 28px; font-weight: 700; margin-bottom: 8px;
      background: var(--gradient);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .subtitle { color: var(--text-secondary); font-size: 16px; font-weight: 400; }

    .form-group { margin-bottom: 24px; position: relative; }
    .form-label { display: block; font-size: 14px; font-weight: 500; color: var(--text-secondary); margin-bottom: 8px; transition: color 0.3s ease; }
    .form-input {
      width: 100%; padding: 16px 20px; background: var(--bg-input); border: 2px solid transparent;
      border-radius: 12px; color: var(--text-primary); font-size: 16px; font-weight: 400; transition: all 0.3s ease; outline: none;
    }
    .form-input:focus { border-color: var(--primary); background: rgba(26, 26, 26, 0.8); transform: translateY(-1px); box-shadow: 0 4px 20px rgba(0, 255, 136, 0.2); }
    .form-input.error { border-color: #ff4444; animation: shake 0.5s ease-in-out; }
    @keyframes shake { 0%,100%{transform:translateX(0)} 25%{transform:translateX(-5px)} 75%{transform:translateX(5px)} }
    .form-input.valid { border-color: var(--primary); }

    .optional { color: var(--text-secondary); font-weight: 400; font-size: 12px; }

    .submit-btn {
      width: 100%; padding: 16px; background: var(--gradient); color: white; border: none; border-radius: 12px;
      font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; position: relative; overflow: hidden;
    }
    .submit-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0, 255, 136, 0.4); }
    .submit-btn:active { transform: translateY(0); }
    .submit-btn:disabled { opacity: 0.7; cursor: not-allowed; transform: none; }
    .submit-btn .btn-text { transition: opacity 0.3s ease; }
    .submit-btn .loading { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); opacity: 0; transition: opacity 0.3s ease; }
    .submit-btn.loading .btn-text { opacity: 0; }
    .submit-btn.loading .loading { opacity: 1; }
    .spinner { width: 20px; height: 20px; border: 2px solid rgba(255, 255, 255, 0.3); border-top: 2px solid white; border-radius: 50%; animation: spin 1s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }

    .progress-bar { width: 100%; height: 4px; background: rgba(255,255,255,0.1); border-radius: 2px; margin-bottom: 24px; overflow: hidden; }
    .progress-fill { height: 100%; background: var(--gradient); width: 0%; transition: width 0.3s ease; border-radius: 2px; }

    /* Bonus inline note (kept for compatibility, hidden by default) */
    .bonus-note { display: none; margin: 16px 0 20px 0; padding: 14px 16px; border-radius: 12px; border: 1px solid var(--primary);
      background: rgba(0,255,136,0.08); color: var(--text-primary); line-height: 1.55; }
    .bonus-note b{ color: var(--primary); }

    /* Modal styles */
    .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.8); backdrop-filter: blur(8px); display: none; align-items: center; justify-content: center; z-index: 1000; padding: 20px; }
    .modal.show { display: flex; animation: fadeIn 0.3s ease; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    .modal-content { background: var(--bg-card); border-radius: 20px; padding: 32px; max-width: 500px; width: 100%;
      border: 1px solid var(--border); box-shadow: var(--shadow); position: relative; animation: modalSlide 0.3s ease; }
    @keyframes modalSlide { from { opacity: 0; transform: scale(0.9) translateY(20px); } to { opacity: 1; transform: scale(1) translateY(0); } }
    .modal-close { position: absolute; top: 16px; right: 16px; width: 32px; height: 32px; border: none; background: rgba(255,255,255,0.1);
      color: var(--text-secondary); border-radius: 8px; cursor: pointer; font-size: 18px; transition: all 0.3s ease; }
    .modal-close:hover { background: rgba(255,255,255,0.2); color: var(--text-primary); }
    .modal-title { font-size: 24px; font-weight: 700; margin-bottom: 16px; color: var(--primary); }
    .modal-text { color: var(--text-secondary); margin-bottom: 24px; line-height: 1.6; }
    .download-list { list-style: none; margin: 0 0 24px 0; }
    .download-item { margin-bottom: 12px; }
    .download-link { display: flex; align-items: center; padding: 12px 16px; background: var(--bg-input); border-radius: 8px;
      text-decoration: none; color: var(--text-primary); transition: all 0.3s ease; border: 1px solid transparent; }
    .download-link:hover { background: rgba(0,255,136,0.1); border-color: var(--primary); transform: translateY(-1px); }
    .download-icon { margin-right: 12px; }

    @media (max-width: 600px){
      .container{ padding: 24px; margin: 10px; }
      .title{ font-size: 24px; }
      .form-input{ padding: 14px 16px; }
    }
  </style>
</head>
<body>
  <iframe id="hidden_iframe" name="hidden_iframe" style="display:none;"></iframe>

  <div class="container">
    <div class="header">
      <h1 class="title">–ó–∞—è–≤–∫–∞ –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é</h1>
      <p class="subtitle">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É –∏ –ø–æ–ª—É—á–∏—Ç–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ</p>
      <div id="bonusNote" class="bonus-note">
        <b>üéÅ –ë–æ–Ω—É—Å—ã –∂–¥—É—Ç –≤–∞—Å:</b> –ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã –≤—ã —Å—Ä–∞–∑—É —Å–º–æ–∂–µ—Ç–µ —Å–∫–∞—á–∞—Ç—å –Ω–∞–±–æ—Ä –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤:
        –º–µ–Ω—é –Ω–∞ 1200/1500/2000 –∫–∫–∞–ª (PDF) –∏ —Å—Ç–∞—Ä—Ç–æ–≤—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –¥–ª—è –º—É–∂—á–∏–Ω –∏ –∂–µ–Ω—â–∏–Ω. 
        –ü—Ä–æ—Å—Ç–æ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã –∏ –Ω–∞–∂–º–∏—Ç–µ ¬´–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É¬ª.
      </div>
    </div>

    <div class="progress-bar">
      <div class="progress-fill" id="progressFill"></div>
    </div>

    <form id="mainForm" action="https://docs.google.com/forms/d/e/1FAIpQLSeXbsEAJ5umw1GqCnbF8O0lrd_Jz_F6ilnlUl1M9GJyVt2DKg/formResponse" method="post" target="hidden_iframe" novalidate>
      <div class="form-group">
        <input class="form-input" type="text" id="name" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è" required autocomplete="given-name">
        <label class="form-label" for="name">–ò–º—è</label>
        <div class="validation-message" id="nameMessage"></div>
      </div>

      <div class="form-group">
        <input class="form-input" type="text" id="surname" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à—É —Ñ–∞–º–∏–ª–∏—é" required autocomplete="family-name">
        <label class="form-label" for="surname">–§–∞–º–∏–ª–∏—è</label>
        <div class="validation-message" id="surnameMessage"></div>
      </div>

      <div class="form-group">
        <input class="form-input" type="email" id="email" placeholder="example@mail.com" required autocomplete="email">
        <label class="form-label" for="email">Email</label>
        <div class="validation-message" id="emailMessage"></div>
      </div>

      <div class="form-group">
        <input class="form-input" type="tel" id="phone" placeholder="+7 (999) 123-45-67" required autocomplete="tel">
        <label class="form-label" for="phone">–¢–µ–ª–µ—Ñ–æ–Ω</label>
        <div class="validation-message" id="phoneMessage"></div>
      </div>

      <div class="form-group">
        <input class="form-input" type="text" id="promo" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥" autocomplete="off">
        <label class="form-label" for="promo">–ü—Ä–æ–º–æ–∫–æ–¥ <span class="optional">(–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</span></label>
      </div>

      <button type="submit" class="submit-btn" id="submitBtn">
        <span class="btn-text">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</span>
        <div class="loading"><div class="spinner"></div></div>
      </button>
    </form>
  </div>

  <!-- Modal -->
  <div class="modal" id="modal">
    <div class="modal-content">
      <button class="modal-close" id="modalClose">√ó</button>
      <div id="modalBody"></div>
    </div>
  </div>

  <script>
    // === Config ===
    const GOOGLE_FORM = {
      action: "https://docs.google.com/forms/d/e/1FAIpQLSeXbsEAJ5umw1GqCnbF8O0lrd_Jz_F6ilnlUl1M9GJyVt2DKg/formResponse",
      entries: {
        name: "entry.335444133",
        surname: "entry.2046906139",
        email: "entry.1743247901",
        phone: "entry.639032647",
        promo: "entry.84195239",
        package: "entry.1448692042"
      }
    };

    const FILES = [
      {name: "–ú–ï–ù–Æ 1200.pdf", file: "menu-1200.pdf"},
      {name: "–ú–ï–ù–Æ 1500.pdf", file: "menu-1500.pdf"},
      {name: "–ú–ï–ù–Æ 2000.pdf", file: "menu-2000.pdf"},
      {name: "–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –¥–ª—è –∂–µ–Ω—â–∏–Ω –≤ —Ç—Ä–µ–Ω–∞–∂–µ—Ä–Ω–æ–º –∑–∞–ª–µ", file: "women-workout.pdf"},
      {name: "–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –¥–ª—è –º—É–∂—á–∏–Ω –≤ —Ç—Ä–µ–Ω–∞–∂–µ—Ä–Ω–æ–º –∑–∞–ª–µ", file: "men-workout.pdf"}
    ];

    // === Utils ===
    function getQueryParam(keys) {
      const params = new URLSearchParams(window.location.search);
      for (const key of keys) {
        const value = params.get(key);
        if (value && value.trim()) return decodeURIComponent(value).trim();
      }
      return "";
    }
    function detectPackage(){ return getQueryParam(["ps","pkg","package","plan","tariff"]) || ""; }
    function isBonusFlow(){ return detectPackage().toUpperCase() === "–ë–û–ù–£–°–´"; }

    // === Validation ===
    class FormValidator {
      constructor() {
        this.fields = {
          name: { required: true, minLength: 2 },
          surname: { required: true, minLength: 2 },
          email: { required: true, pattern: /^[^\s@]+@[^\s@]+\.[^\s@]+$/ },
          phone: { required: true, pattern: /^[\+]?[0-9\s\-\(\)]{10,}$/ }
        };
        this.init();
      }
      init() {
        Object.keys(this.fields).forEach(fieldName => {
          const field = document.getElementById(fieldName);
          if (field) {
            field.addEventListener('input', () => this.validateField(fieldName));
            field.addEventListener('blur', () => this.validateField(fieldName));
          }
        });
      }
      validateField(fieldName) {
        const field = document.getElementById(fieldName);
        const config = this.fields[fieldName];
        const message = document.getElementById(fieldName + 'Message');
        if (!field) return true;
        let isValid = true;
        let errorMessage = '';
        const value = field.value.trim();
        if (config.required && !value) {
          isValid = false; errorMessage = '–≠—Ç–æ –ø–æ–ª–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è';
        } else if (value) {
          if (config.minLength && value.length < config.minLength) {
            isValid = false; errorMessage = `–ú–∏–Ω–∏–º—É–º ${config.minLength} —Å–∏–º–≤–æ–ª–∞`;
          } else if (config.pattern && !config.pattern.test(value)) {
            isValid = false;
            if (fieldName === 'email') errorMessage = '–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email';
            else if (fieldName === 'phone') errorMessage = '–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞';
          }
        }
        field.classList.remove('valid', 'error');
        if (value) field.classList.add(isValid ? 'valid' : 'error');
        if (message) { message.textContent = errorMessage; message.className = `validation-message ${errorMessage ? 'show error' : ''}`; }
        this.updateProgress();
        return isValid;
      }
      validateAll() {
        let allValid = true;
        Object.keys(this.fields).forEach(fieldName => { if (!this.validateField(fieldName)) allValid = false; });
        return allValid;
      }
      updateProgress() {
        const totalFields = Object.keys(this.fields).length;
        let validFields = 0;
        Object.keys(this.fields).forEach(fieldName => {
          const field = document.getElementById(fieldName);
          if (field && field.value.trim() && field.classList.contains('valid')) validFields++;
        });
        const progress = (validFields / totalFields) * 100;
        document.getElementById('progressFill').style.width = progress + '%';
      }
    }

    // === Modal helpers ===
    function showModal(content){
      const m = document.getElementById('modal');
      document.getElementById('modalBody').innerHTML = content;
      m.classList.add('show');
    }
    function hideModal(){ document.getElementById('modal').classList.remove('show'); }
    function showBonusesModal(){
      const list = FILES.map(f => `<li class="download-item"><a class="download-link" href="${f.file}" download="${f.name}"><span class="download-icon">üìÑ</span>${f.name}</a></li>`).join('');
      showModal(`<h2 class="modal-title">üéâ –í–∞—à–∏ –±–æ–Ω—É—Å—ã –≥–æ—Ç–æ–≤—ã!</h2><p class="modal-text">–°–∫–∞—á–∞–π—Ç–µ —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å:</p><ul class="download-list">${list}</ul>`);
    }
    function showSuccessModal(){ showModal(`<h2 class="modal-title">‚úÖ –ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!</h2><p class="modal-text">–°–ø–∞—Å–∏–±–æ –∑–∞ –æ–±—Ä–∞—â–µ–Ω–∏–µ! –ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è.</p>`); }

    // === Personalized greeting ===
    function applyPersonalizedGreeting(){
      const pkgRaw = detectPackage();
      const pkg = (pkgRaw || '').toLowerCase();
      const title = document.querySelector('.title');
      const subtitle = document.querySelector('.subtitle');
      const bonusNote = document.getElementById('bonusNote');

      // Map of flows -> {title, subtitle, hideTitle?}
      const MAP = [
        {
          test: p => p === '–±–æ–Ω—É—Å—ã',
          data: {
            title: '',
            subtitle: 'üéÅ –ë–æ–Ω—É—Å—ã –∂–¥—É—Ç –≤–∞—Å: –ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã –≤—ã —Å—Ä–∞–∑—É —Å–º–æ–∂–µ—Ç–µ —Å–∫–∞—á–∞—Ç—å –Ω–∞–±–æ—Ä –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ ‚Äî —Å—Ç–∞—Ä—Ç–æ–≤—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –¥–ª—è –º—É–∂—á–∏–Ω –∏ –∂–µ–Ω—â–∏–Ω. –ü—Ä–æ—Å—Ç–æ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã –∏ –Ω–∞–∂–º–∏—Ç–µ ¬´–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É¬ª.',
            hideTitle: true,
            showBonusNote: false
          }
        },
        {
          test: p => p === '–∑–∞—è–≤–∫–∞',
          data: {
            title: '–ü–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É',
            subtitle: '–û—Å—Ç–∞–≤—å—Ç–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã ‚Äî –≤—ã—à–ª–µ–º –¥–µ—Ç–∞–ª–∏ —É—á–∞—Å—Ç–∏—è –∏ —Å—Ç–∞—Ä—Ç–æ–≤—É—é –∞–Ω–∫–µ—Ç—É.'
          }
        },
        {
          test: p => p.indexOf('–±–µ—Å–ø–ª–∞—Ç–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞') !== -1,
          data: {
            title: '–ó–∞—è–≤–∫–∞ –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é',
            subtitle: '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É ‚Äî –∏ –º—ã –ø–æ–¥–±–µ—Ä—ë–º —É–¥–æ–±–Ω–æ–µ –≤—Ä–µ–º—è –¥–ª—è –∑–≤–æ–Ω–∫–∞/—á–∞—Ç–∞.'
          }
        },
        {
          test: p => p.indexOf('–±–∞–∑–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç –æ–Ω–ª–∞–π–Ω —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏—è') !== -1,
          data: {
            title: '–ë–∞–∑–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç ‚Äî –∑–∞—è–≤–∫–∞',
            subtitle: '–û—Å—Ç–∞–≤—å—Ç–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã ‚Äî –ø—Ä–∏—à–ª—ë–º –ø—Ä–æ–≥—Ä–∞–º–º—É, —Ü–µ–Ω—É –∏ –¥–µ—Ç–∞–ª–∏ —Å—Ç–∞—Ä—Ç–∞.'
          }
        },
        {
          test: p => p.indexOf('–º–∏–Ω–∏-–≥—Ä—É–ø–ø–∞') !== -1,
          data: {
            title: '–ú–∏–Ω–∏‚Äë–≥—Ä—É–ø–ø–∞ ¬´–ê–≤—Ä–æ—Ä–∞¬ª ‚Äî –∑–∞–ø–∏—Å—å',
            subtitle: '–£–∫–∞–∂–∏—Ç–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã ‚Äî –æ—Ç–ø—Ä–∞–≤–∏–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ, —É—Å–ª–æ–≤–∏—è –∏ –±–ª–∏–∂–∞–π—à–∏–µ –º–µ—Å—Ç–∞.'
          }
        },
        {
          test: p => p.indexOf('—Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ –ø–æ –ø–∏—Ç–∞–Ω–∏—é') !== -1,
          data: {
            title: '–°–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ –ø–æ –ø–∏—Ç–∞–Ω–∏—é',
            subtitle: '–ë–µ–∑ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫: –ø—Ä–∏—à–ª—ë–º –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∏ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –¥–ª—è —Å—Ç–∞—Ä—Ç–∞.'
          }
        },
        {
          test: p => p.indexOf('–ø—Ä–æ–±–Ω–∞—è –Ω–µ–¥–µ–ª—è') !== -1 && (p.indexOf('10.000') !== -1 || p.indexOf('10 000') !== -1),
          data: {
            title: '–ü—Ä–æ–±–Ω–∞—è –Ω–µ–¥–µ–ª—è ‚Äî 10 000 ‚Ç∏',
            subtitle: '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã ‚Äî –ø–æ–ª—É—á–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –ø—Ä–æ–≥—Ä–∞–º–º–µ –∏ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏—é –Ω–∞ 7 –¥–Ω–µ–π.'
          }
        },
        {
          test: p => p.indexOf('–ø—Ä–æ–±–Ω–∞—è –Ω–µ–¥–µ–ª—è') !== -1 && (p.indexOf('15.000') !== -1 || p.indexOf('15 000') !== -1),
          data: {
            title: '–ü—Ä–æ–±–Ω–∞—è –Ω–µ–¥–µ–ª—è ‚Äî 15 000 ‚Ç∏',
            subtitle: '–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø–∞–∫–µ—Ç: –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –∑–∞—è–≤–∫—É ‚Äî –ø—Ä–∏—à–ª—ë–º –¥–æ—Å—Ç—É–ø –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏.'
          }
        }
      ];

      let picked = null;
      for (const item of MAP){ if (item.test(pkg)) { picked = item.data; break; } }

      if (!picked){
        // Fallback default
        picked = { title: '–ó–∞—è–≤–∫–∞ –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é', subtitle: '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É ‚Äî –∏ –º—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏.' };
      }

      if (picked.hideTitle){ title.style.display = 'none'; }
      if (picked.title){ title.textContent = picked.title; title.style.display = ''; }
      if (picked.subtitle){ subtitle.textContent = picked.subtitle; }

      // Bonus inline note behaviour
      if (bonusNote){
        if (pkg === '–±–æ–Ω—É—Å—ã' && picked.showBonusNote !== true){
          bonusNote.style.display = 'none';
        } else {
          bonusNote.style.display = 'none';
        }
      }
    }

    // Phone formatting
    function formatPhone(input){
      let value = input.value.replace(/\\D/g,'');
      if (value.startsWith('8')) value = '7' + value.slice(1);
      if (value.startsWith('7')){
        value = value.slice(0,11);
        const formatted = value.replace(/^7(\\d{3})(\\d{3})(\\d{2})(\\d{2})$/, '+7 ($1) $2-$3-$4');
        if (formatted.includes('(')) input.value = formatted;
      }
    }

    // Submission
    function handleSubmit(e){
      e.preventDefault();
      const validator = new FormValidator();
      if (!validator.validateAll()) return;

      const submitBtn = document.getElementById('submitBtn');
      submitBtn.classList.add('loading'); submitBtn.disabled = true;

      const form = document.getElementById('mainForm');
      // Remove old hidden fields
      form.querySelectorAll('input[type="hidden"]').forEach(i => i.remove());
      // Add hidden fields with Google entries
      Object.entries(GOOGLE_FORM.entries).forEach(([key, entry]) => {
        if (key === 'package'){
          const pkg = detectPackage();
          if (pkg){
            const input = document.createElement('input'); input.type='hidden'; input.name=entry; input.value=pkg; form.appendChild(input);
          }
        } else {
          const field = document.getElementById(key);
          if (field && field.value.trim()){
            const input = document.createElement('input'); input.type='hidden'; input.name=entry; input.value=field.value.trim(); form.appendChild(input);
          }
        }
      });

      // Submit via hidden iframe
      form.submit();
    }

    // Iframe hook: show proper modal after Google Form submission
    (function(){
      const iframe = document.getElementById('hidden_iframe');
      if (!iframe) return;
      iframe.addEventListener('load', function(){
        const submitBtn = document.getElementById('submitBtn');
        if (submitBtn){ submitBtn.classList.remove('loading'); submitBtn.disabled = false; }
        if (isBonusFlow()) showBonusesModal();
        else showSuccessModal();
      });
    })();

    // Init
    document.addEventListener('DOMContentLoaded', function(){
      new FormValidator();
      applyPersonalizedGreeting();

      const form = document.getElementById('mainForm');
      const phoneInput = document.getElementById('phone');
      const modalClose = document.getElementById('modalClose');
      const modal = document.getElementById('modal');

      form.addEventListener('submit', handleSubmit);
      phoneInput.addEventListener('input', function(){ formatPhone(this); });
      modalClose.addEventListener('click', hideModal);
      modal.addEventListener('click', function(e){ if (e.target === modal) hideModal(); });
      document.addEventListener('keydown', function(e){ if (e.key === 'Escape' && modal.classList.contains('show')) hideModal(); });
    });
  </script>
</body>
</html>
