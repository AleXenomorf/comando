<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–û—Å—Ç–∞–≤—å—Ç–µ —Å–≤–æ–∏ –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;900&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    :root { --primary-color:#00cc00; --secondary-color:#00aa00; --dark-bg:rgba(0,0,0,0.7); --text-shadow:0 2px 4px rgba(0,0,0,0.3); }
    html,body{margin:0;padding:0;font-family:'Montserrat',sans-serif;color:#fff;background:#333;height:100%;overflow-x:hidden;}
    .test-container{max-width:800px;margin:0 auto;padding:40px 20px;position:relative;min-height:100vh;box-sizing:border-box;display:flex;flex-direction:column;justify-content:center;}
    .question-slide{display:block;animation:fadeIn .5s ease;background:rgba(255,255,255,.1);border-radius:15px;padding:30px;box-shadow:0 10px 30px rgba(0,0,0,.3);}
    .question-header{display:flex;align-items:center;margin-bottom:15px;}
    .question-icon{font-size:24px;margin-right:15px;color:var(--primary-color);}
    .question-title{font-family:'Playfair Display',serif;font-size:24px;color:var(--primary-color);margin-bottom:30px;text-align:center;text-shadow:var(--text-shadow);}
    .form-group{margin-bottom:20px;}
    .form-group label{display:block;margin-bottom:8px;color:#fff;font-weight:600;}
    .form-group input{width:100%;padding:12px 15px;border-radius:8px;border:2px solid #ddd;font-size:16px;box-sizing:border-box;}
    .info-block{background:rgba(0,204,0,.1);border-left:4px solid var(--primary-color);padding:15px;margin-bottom:25px;border-radius:0 8px 8px 0;}
    .info-block p{margin:0;font-size:15px;line-height:1.5;}
    .nav-buttons{display:flex;justify-content:center;margin-top:30px;}
    .nav-button{background:var(--primary-color);color:#fff;border:none;padding:12px 25px;border-radius:50px;cursor:pointer;font-size:16px;font-weight:600;transition:all .3s;text-align:center;}
    .nav-button:hover{background:var(--secondary-color);transform:translateY(-2px);box-shadow:0 5px 15px rgba(0,204,0,.4);}
    .nav-button:disabled{background:#ccc;cursor:not-allowed;transform:none;box-shadow:none;}
    #submitButton{background:#ff6600;} #submitButton:hover{background:#e65c00;}
    .success-message{display:none;background:rgba(0,204,0,.2);border:1px solid var(--primary-color);padding:20px;border-radius:10px;text-align:center;margin-top:20px;animation:fadeIn .5s ease;}
    @keyframes fadeIn{from{opacity:0;transform:translateY(20px);}to{opacity:1;transform:translateY(0);}}
    @media (max-width:768px){
      .test-container{padding:20px 15px;justify-content:flex-start;min-height:auto;}
      .question-title{font-size:20px;margin-bottom:20px;}
      .question-slide{padding:20px 15px;}
      .nav-button{padding:10px 15px;font-size:14px;}
    }
  </style>
</head>
<body>
  <div class="test-container">
    <div class="question-slide" id="question6">
      <div class="question-header">
        <div class="question-icon"><i class="fas fa-user"></i></div>
        <div><h2 class="question-title">–û—Å—Ç–∞–≤—å—Ç–µ —Å–≤–æ–∏ –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h2></div>
      </div>

      <div class="info-block">
        <p><i class="fas fa-info-circle"></i> –û—Å—Ç–∞–≤—å—Ç–µ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ, –∏ –º—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è.</p>
      </div>

      <div class="options-container">
        <div class="form-group">
          <label for="firstName">–ò–º—è</label>
          <input type="text" id="firstName" required>
        </div>
        <div class="form-group">
          <label for="lastName">–§–∞–º–∏–ª–∏—è</label>
          <input type="text" id="lastName" required>
        </div>
        <div class="form-group">
          <label for="email">Email</label>
          <input type="email" id="email" required placeholder="example@mail.com">
        </div>
        <div class="form-group">
          <label for="whatsapp">–ù–æ–º–µ—Ä WhatsApp (—Å –∫–æ–¥–æ–º —Å—Ç—Ä–∞–Ω—ã)</label>
          <input type="tel" id="whatsapp" required placeholder="+79123456789">
        </div>
      </div>
    </div>

    <div class="nav-buttons">
      <button class="nav-button" id="submitButton" disabled>–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</button>
    </div>

    <div class="success-message" id="successMessage">
      <h3>‚úÖ –°–ø–∞—Å–∏–±–æ! –í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã</h3>
      <p>–ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è —á–µ—Ä–µ–∑ WhatsApp</p>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // ============= –ù–ê–°–¢–†–û–ô–ö–ê –ü–†–û–ö–°–ò (–∑–∞–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ–π –¥–µ–ø–ª–æ–π) =============
      // –í–ê–†–ò–ê–ù–¢ 1: Cloudflare Workers: https://<your-worker>.<subdomain>.workers.dev
      // –í–ê–†–ò–ê–ù–¢ 2: Vercel:             https://<your-vercel-domain>/api/telegram
      const PROXY_URL = "https://<your-proxy-endpoint>";
      const APP_KEY   = "<your_app_key>";   // —Ç–æ—Ç –∂–µ APP_KEY, —á—Ç–æ –∑–∞–¥–∞–Ω –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –ø—Ä–æ–∫—Å–∏
      const DEFAULT_CHAT_ID = "1208941214"; // –º–æ–∂–Ω–æ —É–±—Ä–∞—Ç—å, –µ—Å–ª–∏ –∑–∞–¥–∞—ë—à—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

      // ============= Google Forms (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π endpoint) =============
      const googleFormsConfig = {
        formUrl: "https://docs.google.com/forms/d/e/1FAIpQLScf0Axx5RUF20o3DuZ1YzO3bj0oP75GlJgTqLEIDTB9kNy_AA/formResponse",
        fieldIds: {
          firstName: "entry.575542865",
          lastName:  "entry.1529853970",
          email:     "entry.63446999",
          whatsapp:  "entry.826076263"
        }
      };

      const submitButton   = document.getElementById('submitButton');
      const successMessage = document.getElementById('successMessage');
      const firstNameEl = document.getElementById('firstName');
      const lastNameEl  = document.getElementById('lastName');
      const emailEl     = document.getElementById('email');
      const whatsappEl  = document.getElementById('whatsapp');

      function checkFormFilled() {
        const firstName = firstNameEl.value.trim();
        const lastName  = lastNameEl.value.trim();
        const email     = emailEl.value.trim();
        const whatsapp  = whatsappEl.value.trim();
        return firstName && lastName && email && whatsapp;
      }

      function updateSubmitButton() {
        submitButton.disabled = !checkFormFilled();
      }

      async function sendToGoogleForms(data) {
        const formData = new URLSearchParams();
        formData.append(googleFormsConfig.fieldIds.firstName, data.firstName);
        formData.append(googleFormsConfig.fieldIds.lastName,  data.lastName);
        formData.append(googleFormsConfig.fieldIds.email,     data.email);
        formData.append(googleFormsConfig.fieldIds.whatsapp,  data.whatsapp);
        formData.append('fvv', '1');
        formData.append('pageHistory', '0');
        formData.append('submit', 'Submit');

        await fetch(googleFormsConfig.formUrl, {
          method: 'POST',
          mode: 'no-cors',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
          body: formData.toString(),
        });
      }

      async function sendToTelegramViaProxy(message) {
        const resp = await fetch(PROXY_URL, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'X-App-Key': APP_KEY
          },
          body: JSON.stringify({
            chat_id: DEFAULT_CHAT_ID,
            text: message,
            parse_mode: 'Markdown'
          })
        });
        // –ü—Ä–æ–∫—Å–∏ –æ—Ç–¥–∞—ë—Ç CORS-–∑–∞–≥–æ–ª–æ–≤–∫–∏, –ø–æ—ç—Ç–æ–º—É –º–æ–∂–Ω–æ —á–∏—Ç–∞—Ç—å resp.ok/—Å—Ç–∞—Ç—É—Å –ø—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏
        // –ó–¥–µ—Å—å –Ω–µ –±—Ä–æ—Å–∞–µ–º –æ—à–∏–±–∫—É –Ω–∞ no-cors —Å—Ü–µ–Ω–∞—Ä–∏–π ‚Äî –Ω–æ Cloudflare/Vercel –≤–µ—Ä–Ω—É—Ç JSON.
        if (!resp.ok) {
          const text = await resp.text().catch(()=>''); 
          throw new Error('Proxy error ' + resp.status + ': ' + text);
        }
      }

      submitButton.addEventListener('click', async function() {
        if (!checkFormFilled()) return;

        const contactData = {
          firstName: firstNameEl.value.trim(),
          lastName:  lastNameEl.value.trim(),
          email:     emailEl.value.trim(),
          whatsapp:  whatsappEl.value.trim()
        };

        const message = [
          'üìã *–ù–æ–≤—ã–µ –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ*',
          '',
          `üë§ *–ò–º—è:* ${contactData.firstName} ${contactData.lastName}`,
          `üìß *Email:* ${contactData.email}`,
          `üì± *WhatsApp:* ${contactData.whatsapp}`
        ].join('\\n');

        try {
          submitButton.disabled = true;
          submitButton.textContent = '–û—Ç–ø—Ä–∞–≤–∫–∞...';

          // 1) Telegram —á–µ—Ä–µ–∑ –∑–∞—â–∏—â—ë–Ω–Ω—ã–π –ø—Ä–æ–∫—Å–∏ (–±–µ–∑ —Ç–æ–∫–µ–Ω–∞ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ)
          await sendToTelegramViaProxy(message);

          // 2) –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Google Forms (–¥–ª—è CRM/—Ç–∞–±–ª–∏—Ü—ã)
          await sendToGoogleForms(contactData);

          // –£—Å–ø–µ—Ö UI
          successMessage.style.display = 'block';
          submitButton.style.display = 'none';

          // –û—á–∏—Å—Ç–∫–∞
          firstNameEl.value = '';
          lastNameEl.value  = '';
          emailEl.value     = '';
          whatsappEl.value  = '';
        } catch (error) {
          console.error('–û—à–∏–±–∫–∞:', error);
          alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ. –ü—Ä–æ–≤–µ—Ä—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–∫—Å–∏ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.');
          submitButton.disabled = false;
          submitButton.textContent = '–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã';
        }
      });

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π
      [firstNameEl, lastNameEl, emailEl, whatsappEl].forEach(el => {
        el.addEventListener('input', updateSubmitButton);
      });
      updateSubmitButton();
    });
  </script>
</body>
</html>
