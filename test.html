<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Форма заявки</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;900&display=swap" rel="stylesheet">
  <style>
    :root { --ok:#00cc66; }
    body{margin:0;font-family:Montserrat,system-ui,Arial;color:#fff;background:#2c2c2c}
    .wrap{max-width:900px;margin:0 auto;padding:28px;min-height:100vh}
    .card{background:#333;border-radius:14px;padding:20px;box-shadow:0 8px 24px rgba(0,0,0,.35)}
    h1{margin:0 0 10px}
    label{display:block;margin:10px 0 6px;font-weight:600}
    input[type="text"]{width:100%;padding:12px;border-radius:10px;border:2px solid #ccc;box-sizing:border-box}
    .btn{display:inline-block;background:#ff6600;border:none;color:#fff;padding:12px 22px;border-radius:999px;font-weight:800;cursor:pointer}
    .ok{display:none;margin-top:12px;padding:12px;border-radius:10px;background:rgba(0,204,102,.15);border:1px solid var(--ok);text-align:center}
    .preview{margin:6px 0 12px;opacity:.95}
  </style>

<style id="overlay-theme">
#bonuses-overlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.9);z-index:9999}
#bonuses-overlay .box{
  position:relative;
  max-width:780px;
  width:min(92vw,780px);
  background:linear-gradient(180deg, #121212 0%, #161616 100%);
  border:1px solid rgba(0, 255, 128, .18);
  border-radius:18px;
  padding:24px 22px;
  box-shadow:0 20px 60px rgba(0,0,0,.55), 0 0 0 1px rgba(0,255,128,.08) inset;
  color:#fff;
  font-family:Montserrat,system-ui,Arial,sans-serif;
}
.overlay-title{margin:0 0 6px;font-size:22px;font-weight:800;letter-spacing:.2px}
.overlay-intro{opacity:.9;margin:0 0 10px}
.overlay-list{margin:6px 0 0 18px;line-height:1.8}
.overlay-zip{margin-top:12px}
.dl-link{
  display:inline-block;
  padding:10px 14px;
  border-radius:14px;
  text-decoration:none;
  color:#fff;
  background:linear-gradient(45deg, var(--primary-color,#00b900), var(--secondary-color,#00e676));
  box-shadow:0 6px 22px rgba(0, 204, 0, .55);
  font-weight:700;
}
#bonuses-overlay .overlay-close{
  position:absolute; top:10px; right:10px;
  width:36px; height:36px; border-radius:10px;
  border:1px solid rgba(0,255,128,.3);
  background:rgba(255,255,255,.06);
  color:#fff; font-size:22px; line-height:32px; cursor:pointer;
  box-shadow:0 6px 22px rgba(0,0,0,.35);
}
#bonuses-overlay .overlay-close:hover{ background:rgba(255,255,255,.12); }
</style>
<script id="overlay-close-logic">
(function(){
  document.addEventListener('click', function(e){
    var btn = e.target.closest('[data-close-overlay]');
    if(!btn) return;
    e.preventDefault();
    var ov = document.getElementById('bonuses-overlay');
    if (ov) ov.style.display = 'none';
    // Redirect to homepage after close:
    location.href = 'https://alexenomorf.github.io/comando/';
  });
})();
</script>


<script id="bonus-flow-helper">
(function(){
  window.__isBonusFlow = function(){
    function norm(x){ return (x||'').toString().trim().toUpperCase(); }
    var ps = ""; try { ps = new URLSearchParams(location.search).get('ps') || ""; } catch(_){}
    var ls = ""; try { ls = localStorage.getItem('selectedPackageShort') || ""; } catch(_){}
    var ss = ""; try { ss = sessionStorage.getItem('lastSelectedPackageShort') || ""; } catch(_){}
    return norm(ps)==="БОНУСЫ" || norm(ls)==="БОНУСЫ" || norm(ss)==="БОНУСЫ";
  };
})();
</script>


<script id="overlay-show-helper">
(function(){
  var shown = false;
  window.__showBonusOverlay = function(){
    if (shown) return;
    shown = true;
    try { if (typeof buildDownloads === 'function') buildDownloads(); } catch(_){}
    var ov = document.getElementById('bonuses-overlay');
    if (ov) ov.style.display = 'flex';
    try { window.scrollTo({top:0, behavior:'smooth'}); } catch(_){}
  };
})();
</script>

</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>Оставьте свои контактные данные</h1><iframe name="hidden_iframe" id="hidden_iframe" style="display:none"></iframe>

    
<div id="package-preview" style="font-weight:700; margin: 1em 0; font-size:1.05em;"></div>
<form id="gform"
      onsubmit="document.getElementById('submitBtn').disabled=true;"
      action="https://docs.google.com/forms/d/e/1FAIpQLScf0Axx5RUF20o3DuZ1YzO3bj0oP75GlJgTqLEIDTB9kNy_AA/formResponse"
      method="POST" target="hidden_iframe" novalidate>

      <label>Имя</label>
      <input type="text" name="entry.575542865">

      <label>Фамилия</label>
      <input type="text" name="entry.1529853970">

      <label>Email</label>
      <input type="text" name="entry.63446999">

      <label>Номер WhatsApp (с кодом страны)</label>
      <input type="text" name="entry.826076263">

      <label>Промокод</label>
      <input type="text" name="entry.3032165">

      <!-- Выбор пакета (ТОЛЬКО короткий ps) -->
      <div style="margin-top:14px">
        <button type="submit" class="btn" id="sendBtn">Оставить заявку</button>
      </div>
    </form>

    <div id="ok" class="ok">✅ Спасибо! Заявка отправлена.</div>
  
</div>
</div>

<script>
(function(){
  function g(n){ try{ return new URLSearchParams(location.search).get(n) || ''; }catch(e){ return ''; } }
  var ps = g('ps');
  if(!ps){
    try { var s = localStorage.getItem('selectedPackageShort'); if(s){ ps = s; localStorage.removeItem('selectedPackageShort'); } } catch(e){}
  }
  document.getElementById('servicesHidden').value = ps;
  

  var form = document.getElementById('gform');
  var btn  = document.getElementById('sendBtn');

  form.addEventListener('submit', function(){
    btn.disabled = true;
    setTimeout(function(){ document.getElementById('ok').style.display='block'; btn.disabled = false; }, 1600);
  });
  document.getElementById('hidden_iframe').addEventListener('load', function(){
    document.getElementById('ok').style.display='block';
    btn.disabled = false;
  });
})();
</script>

<!-- PACKAGE APPLY (strict preview formatting) -->
<script>
document.addEventListener('DOMContentLoaded', function(){
  var params = new URLSearchParams(location.search);
  var raw = params.get('ps') || localStorage.getItem('selectedPackageShort') || sessionStorage.getItem('lastSelectedPackageShort') || '';
  // Clean leading punctuation/whitespace like ": Пробная 15 000"
  var pkg = (raw || '').replace(/^[\s:—\-]+/, '').trim();
  var preview = document.getElementById('package-preview');

  if (pkg && pkg.length > 0) {
    if (preview) {
      preview.textContent = 'Вы выбрали: ' + pkg;
      preview.style.display = '';
    }
  } else {
    if (preview && preview.parentNode) {
      preview.parentNode.removeChild(preview); // remove entirely so ничего не мелькает
    }
  }

  // Hidden field for Google Form
  var form = document.querySelector('form');
  if (!form) return;
  var field = form.querySelector('input[name="entry.1735060909"]');
  if (!field) {
    field = document.createElement('input');
    field.type = 'hidden';
    field.name = 'entry.1735060909';
    form.appendChild(field);
  }
  if (pkg) field.value = pkg;

  try {
    if (pkg) {
      localStorage.setItem('selectedPackageShort', pkg);
      sessionStorage.setItem('lastSelectedPackageShort', pkg);
    }
  } catch (_) {}
});
</script>

<!-- Bonuses overlay (visible only if ps=БОНУСЫ after successful submit) -->
<style>
  #bonuses-overlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.88);z-index:9999}
  #bonuses-overlay .box{max-width:720px;background:#333;border-radius:16px;border:1px solid rgba(255,255,255,.15);padding:24px;box-shadow:0 10px 30px rgba(0,0,0,.45);color:#fff}
  #bonuses-overlay h2{margin:0 0 12px}
  #bonuses-overlay ul{margin:6px 0 0 18px;line-height:1.7}
</style>
<div id="bonuses-overlay" aria-hidden="true">
  <div class="box" id="bonuses-overlay-content"></div></div>

<script>
(function(){
  function getPs(){
    try { return new URLSearchParams(location.search).get('ps') || ''; } catch(e){ return ''; }
  }
  var ps = getPs();
  var isBonus = (ps === 'БОНУСЫ');

  // Preview selected package/tag
  var prev = document.getElementById('package-preview');
  if (prev && ps) { prev.textContent = 'Вы выбрали: ' + ps; }

  // Put ps into hidden fields so it lands in the sheet
  var pkg = document.getElementById('entry_package_ps');
  var tag = document.getElementById('entry_tag_ps');
  var src = document.getElementById('entry_source_ps');
  if (pkg) pkg.value = ps || '';
  if (tag) tag.value = ps || '';
  if (src) src.value = 'test_form';

  // After submit (iframe loads), if ps == "БОНУСЫ" show overlay instead of OK
  var iframe = document.getElementById('hidden_iframe');
  if (iframe) {
    iframe.addEventListener('load', function(){
      if (isBonus) {
        var ok = document.getElementById('ok');
        if (ok) ok.style.display = 'none';
        var ov = document.getElementById('bonuses-overlay');
        if (ov) ov.style.display = 'flex';
        try { window.scrollTo({top:0, behavior:'smooth'}); } catch(_){}
      }
    });
  }
})();
</script>


<script>
(function(){
  function getPs(){
    try { return new URLSearchParams(location.search).get('ps') || ''; } catch(e){ return ''; }
  }
  var ps = getPs();
  var isBonus = (ps === 'БОНУСЫ');
  var submitted = false;

  var form = document.getElementById('gform');
  if (form) {
    form.addEventListener('submit', function(){
      submitted = true;
      // визуально заблокируем сабмит
      var btn = form.querySelector('button[type="submit"], input[type="submit"]');
      if (btn) btn.disabled = true;
    });
  }

  var files = ["МЕНЮ 1200.pdf","МЕНЮ 1500.pdf","МЕНЮ 2000.pdf","тренировка для женщин в тренажерном зале - тренировка.pdf","тренировка для мужчин в тренажерном зале - тренировка.pdf"];
  var zipFile = null;

  
function buildDownloads(){
  var box = document.getElementById('bonuses-overlay-content') || document.querySelector('#bonuses-overlay .box');
  if (!box) return;
  var items = (Array.isArray(window.files) ? window.files : []);
  var out = '';
  out += '<button class="overlay-close" data-close-overlay aria-label="Закрыть">×</button>';
  out += '<h2 class="overlay-title">Ваши бонусы</h2>';
  out += '<p class="overlay-intro">Скачайте материалы прямо сейчас:</p>';
  out += '<ul class="overlay-list">';
  for (var i=0;i<items.length;i++){ var f = items[i]; var u = encodeURI(f); out += '<li><a class="dl-link" href="'+u+'" download>'+f+'</a></li>'; }
  out += '</ul>';
  if (typeof window.zipFile === 'string' && window.zipFile){ var zu = encodeURI(window.zipFile); out += '<p class="overlay-zip"><a class="dl-link" href="'+zu+'" download>Скачать всё одним архивом (ZIP)</a></p>'; }
  box.innerHTML = out;
}).join('') + '</ul>';
  var zip = (typeof zipFile === 'string' && zipFile) ?
            '<p class="overlay-zip"><a class="dl-link" href="'+encodeURI(zipFile)+'" download>Скачать всё одним архивом (ZIP)</a></p>'
            : '';
  box.innerHTML = closeBtn + h2 + intro + list + zip;
}
);
    box.appendChild(ul);
    if (zipFile) { var p = document.createElement("p"); p.style.marginTop = "10px"; var aZip = document.createElement("a"); aZip.href = encodeURI(zipFile); aZip.setAttribute("download",""); aZip.textContent = "Скачать всё одним архивом (ZIP)"; p.appendChild(aZip); box.appendChild(p); }
  }

  var iframe = document.getElementById('hidden_iframe');
  if (iframe) {
    iframe.addEventListener('load', function(){
      // показываем только если 1) реально сабмитили форму, 2) переход был через БОНУСЫ
      if ((typeof window.__isBonusFlow==="function" ? window.__isBonusFlow() : false) && submitted) { if (typeof window.__showBonusOverlay==="function") window.__showBonusOverlay();
        try { window.scrollTo({top:0, behavior:'smooth'}); } catch(_){}
      }
    });
  }
})();
</script>


<script id="form-guard">
(function(){
  var form = document.getElementById('gform');
  if (!form) return;

  // Mark all input/select/textarea (except hidden/disabled) as required:
  Array.prototype.forEach.call(form.querySelectorAll('input, select, textarea'), function(el){
    var t = (el.getAttribute('type')||'').toLowerCase();
    if (el.disabled) return;
    if (t === 'hidden' || t === 'submit' || t === 'button' || t === 'checkbox' || t === 'radio') return;
    el.setAttribute('required','required');
  });

  var submittedOnce = false;
  var submitBtn = form.querySelector('button[type="submit"], input[type="submit"]');
  // Fallback: show overlay also on submit-button click (helps on some mobile browsers)
  if (submitBtn) {
    submitBtn.addEventListener('click', function(){
      // don't show if we've already submitted or bonus flag is false
      if (submittedOnce) return;
      var bonus = (typeof window.__isBonusFlow==="function" ? window.__isBonusFlow() : false);
      if (!bonus) return;
      // quick client-side precheck: no empty required fields
      var bad = (function(){ 
        var fields = form.querySelectorAll('input[required],select[required],textarea[required]');
        for (var i=0;i<fields.length;i++){ var v=(fields[i].value||'').trim(); if(!v) return true; } return false; 
      })();
      if (!bad) { try { if (typeof window.__showBonusOverlay==="function") window.__showBonusOverlay(); } catch(_){}}}, true);
  }


  function firstEmptyField(){
    var fields = form.querySelectorAll('input[required],select[required],textarea[required]');
    for (var i=0;i<fields.length;i++){
      var el = fields[i];
      var v = (el.value || '').trim();
      if (!v){
        return el;
      }
    }
    return null;
  }

  form.addEventListener('submit', function(e){
    // compute ps and bonus flag
    var isBonus = (typeof window.__isBonusFlow === "function" ? window.__isBonusFlow() : false);
    // 1) block if any required field empty
    var bad = firstEmptyField();
    if (bad){
      e.preventDefault(); e.stopPropagation();
      try { bad.focus(); } catch(_){}
      // brief visual
      bad.style.outline = '2px solid #ff6b6b';
      setTimeout(function(){ bad.style.outline=''; }, 1200);
      return;
    }
    // 2) if bonus flow, show overlay immediately (no 'Готовим бонусы…')
    if (isBonus) { try { if (typeof window.__showBonusOverlay==="function") window.__showBonusOverlay(); } catch(_){}}catch(_) {}
    }
    // 3) lock after first click
    if (submittedOnce){
      e.preventDefault(); e.stopPropagation();
      return;
    }
    submittedOnce = true;
    if (submitBtn){
      submitBtn.disabled = true;
      submitBtn.setAttribute('aria-busy','true');
      submitBtn.style.opacity = '.7';
      submitBtn.style.pointerEvents = 'none';
    }
    // Also disable other interactive fields to avoid re-edits during submit
    Array.prototype.forEach.call(form.elements, function(el){ try{ el.readOnly = true; el.disabled = (el === submitBtn) ? true : el.disabled; }catch(_){}});
  }, true);
})();
</script>


<script id="dedupe-entry-fields">
(function(){
  var form = document.getElementById('gform');
  if (!form) return;

  function isHiddenLike(el){
    if (!el) return true;
    if ((el.type||'').toLowerCase() === 'hidden') return true;
    if (el.hasAttribute('hidden')) return true;
    var s = window.getComputedStyle ? window.getComputedStyle(el) : null;
    if (s && (s.display === 'none' || s.visibility === 'hidden' || s.opacity === '0')) return true;
    // also treat zero-size as hidden-ish
    if ((el.offsetWidth === 0 && el.offsetHeight === 0)) return true;
    return false;
  }

  form.addEventListener('submit', function(){
    // 1) remove our legacy custom fields (if вдруг остались)
    Array.prototype.forEach.call(form.querySelectorAll(
      'input[name="entry_package_ps"], input[name="entry_tag_ps"], input[name="entry_source_ps"]'
    ), function(el){ try{ el.remove(); }catch(_){}});

    // 2) de-duplicate any Google entry.* fields: keep ONE per name, prefer visible element
    var map = Object.create(null);
    var fields = form.querySelectorAll('input[name^="entry."], textarea[name^="entry."], select[name^="entry."]');
    Array.prototype.forEach.call(fields, function(el){
      var n = el.name;
      var hidden = isHiddenLike(el);
      if (!map[n]) {
        map[n] = { el: el, visible: !hidden };
      } else {
        var prev = map[n];
        if (!prev.visible && !hidden) {
          // prefer visible now: remove old
          try { prev.el.parentNode && prev.el.parentNode.removeChild(prev.el); } catch(_){}
          map[n] = { el: el, visible: true };
        } else {
          // remove duplicate
          try { el.parentNode && el.parentNode.removeChild(el); } catch(_){}
        }
      }
    });
  }, true);
})();
</script>

</body>
</html>
